(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{315:function(e,t,i){"use strict";i.r(t);var n=i(317),o=i(318),s=i.n(o);function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=Math.PI/2,h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.object=t,this.enabled=!0,this.movementSpeed=100,this.lookSpeedX=30,this.lookSpeedY=30,this.minY=Number.NEGATIVE_INFINITY,this.maxY=Number.POSITIVE_INFINITY,this.pitch=new n.f,this.yaw=new n.f,this.yaw.add(this.pitch),this.pitch.add(this.object),this.mouseDown=!1,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.pitchUp=!1,this.pitchDown=!1,this.yawLeft=!1,this.yawRight=!1,this.velocity=new n.m,this.direction=new n.m,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),document.addEventListener("keydown",this.onKeyDown,!1)}var t,i,o;return t=e,(i=[{key:"getObject",value:function(){return this.yaw}},{key:"dispose",value:function(){document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),document.removeEventListener("mousedown",this.onMouseDown,!1),document.removeEventListener("keyup",this.onKeyUp,!1),document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"onMouseMove",value:function(e){if(!this.enabled||!this.mouseDown)return!1;var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;this.yaw.rotation.y-=t*this.lookSpeedX/1e4,this.pitch.rotation.x-=i*this.lookSpeedY/1e4,this.pitch.rotation.x=Math.max(-r,Math.min(r,this.pitch.rotation.x))}},{key:"onMouseUp",value:function(e){this.mouseDown=!1}},{key:"onMouseDown",value:function(e){this.mouseDown=!0}},{key:"onKeyDown",value:function(e){switch(e.keyCode){case 16:this.shiftKey=!0;break;case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.moveUp=!0;break;case 69:this.moveDown=!0;break;case 73:this.pitchUp=!0;break;case 75:this.pitchDown=!0;break;case 74:this.yawLeft=!0;break;case 76:this.yawRight=!0}}},{key:"onKeyUp",value:function(e){switch(event.keyCode){case 16:this.shiftKey=!1;break;case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 81:this.moveUp=!1;break;case 69:this.moveDown=!1;break;case 73:this.pitchUp=!1;break;case 75:this.pitchDown=!1;break;case 74:this.yawLeft=!1;break;case 76:this.yawRight=!1}}},{key:"update",value:function(e){if(this.velocity.x-=10*this.velocity.x*e,this.velocity.z-=10*this.velocity.z*e,this.direction.z=Number(this.moveForward)-Number(this.moveBackward),this.direction.x=Number(this.moveLeft)-Number(this.moveRight),this.direction.normalize(),(this.moveForward||this.moveBackward)&&(this.velocity.z-=this.direction.z*this.movementSpeed*e),(this.moveLeft||this.moveRight)&&(this.velocity.x-=this.direction.x*this.movementSpeed*e),(this.pitchUp||this.pitchDown)&&(this.pitch.rotation.x-=(Number(this.pitchDown)-Number(this.pitchUp))*this.lookSpeedY/1e3,this.pitch.rotation.x=Math.max(-r,Math.min(r,this.pitch.rotation.x))),(this.yawLeft||this.yawRight)&&(this.yaw.rotation.y-=(Number(this.yawRight)-Number(this.yawLeft))*this.lookSpeedX/1e3),this.yaw.translateX(this.velocity.x*e),this.yaw.translateZ(this.velocity.z*e),this.moveUp||this.moveDown){var t=(Number(this.moveUp)-Number(this.moveDown))/25;this.object.position.y=Math.max(this.minY,Math.min(this.maxY,this.object.position.y-t))}}}])&&a(t.prototype,i),o&&a(t,o),e}();function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=t,this.index=i,this.keyPress={},this.camPosition=new n.m(0,0,0)}var t,o,a;return t=e,(o=[{key:"addView",value:function(e,t){var o=new n.j(5,16,16),a=new n.i({uniforms:{color:{type:"t",value:e},resolution:{type:"vec2",value:new n.l},objectPosition:{type:"vec3",value:t},imageFormat:{type:"int",value:1}},vertexShader:s()(i(319)),fragmentShader:s()(i(320))});a.side=n.a;var r=new n.d(o,a);r.position.x=t.x,r.position.y=t.y,r.position.z=t.z,this.scene.add(r),this.material=a}},{key:"init",value:function(){this.scene=new n.h,this.camera=new n.g(60,window.innerWidth/window.innerHeight,.001,100),this.camera.position.z=0,this.renderer=new n.n({antialias:!0,alpha:!0}),this.renderer.domElement.width=window.innerWidth,this.renderer.domElement.height=window.innerHeight,this.clock=new n.b,this.controls=new h(this.camera),this.scene.add(this.controls.getObject());var e=document.getElementById("image"),t=new n.k(e);t.needsUpdate=!0,t.minFilter=n.c,t.magFilter=n.e,this.addView(t,new n.m(0,0,0))}},{key:"updateTexture",value:function(){var e=document.getElementById("image"),t=new n.k(e);t.needsUpdate=!0,t.minFilter=n.c,t.magFilter=n.e,this.material.uniforms.color.value=t}},{key:"updateImageFormat",value:function(e){this.material.uniforms.imageFormat.value=e}},{key:"update",value:function(){var e=this.clock.getDelta();this.controls.update(e/10)}},{key:"draw",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(e,t){this.renderer&&(this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.fovHeight=2*Math.tan(this.camera.fov*Math.PI/180/2)*this.camera.position.z,this.fovWidth=this.fovHeight*this.camera.aspect,this.renderer.setSize(e,t),this.material&&(this.material.uniforms.resolution.value.x=e),this.material&&(this.material.uniforms.resolution.value.y=t))}},{key:"keyup",value:function(e){this.keyPress[e]=!1}},{key:"keydown",value:function(e){this.keyPress[e]=!0}}])&&c(t.prototype,o),a&&c(t,a),e}();function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,"default",(function(){return l}));var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contexts=[],this.el=document.querySelector(".container")}var t,i,n;return t=e,(i=[{key:"init",value:function(){var e=new u(this,0);e.init(),this.contexts.push(e);var t=[Trixie.effects.colorBalance({r:1,g:1,b:.9}),Trixie.effects.convolve({kernel:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}),Trixie.effects.erode({element:[0,1,0,1,1,1,0,1,0]}),Trixie.effects.dilate({element:[0,1,0,1,1,1,0,1,0]}),Trixie.effects.convolve({kernel:[0,-.25,0,-.25,2,-.25,0,-.25,0]})];this.txCanvas=document.createElement("canvas"),this.txCanvas.id="tx-canvas",this.tx=new Trixie({input:e.renderer.domElement,effects:t,output:this.txCanvas}),this.el.appendChild(this.txCanvas),this.addListeners(),this.animate(),this.resize()}},{key:"addListeners",value:function(){var e=this;this.handlerAnimate=this.animate.bind(this),window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("keyup",this.keyup.bind(this)),window.addEventListener("keydown",this.keydown.bind(this)),document.getElementById("input").addEventListener("change",(function(t){var i=t.target.files[0],n=new FileReader;n.onloadend=function(){document.getElementById("image").src=n.result,e.contexts.forEach((function(e){e.updateTexture()}))},i&&n.readAsDataURL(i)})),document.getElementById("format").addEventListener("change",(function(t){e.contexts.forEach((function(e){t.target[0].selected&&e&&e.updateImageFormat(0),t.target[1].selected&&e&&e.updateImageFormat(1)}))}))}},{key:"animate",value:function(){this.update(),this.draw(),window.requestAnimationFrame(this.animate.bind(this))}},{key:"update",value:function(){this.contexts.forEach((function(e){e&&e.update()}))}},{key:"draw",value:function(){this.contexts.forEach((function(e){e&&e.draw()})),this.tx&&this.tx.gl&&(this.tx.gl.bindTexture(this.tx.gl.TEXTURE_2D,this.tx.originalTexture),this.tx.gl.texImage2D(this.tx.gl.TEXTURE_2D,0,this.tx.gl.RGBA,this.tx.gl.RGBA,this.tx.gl.UNSIGNED_BYTE,this.contexts[0].renderer.domElement)),this.tx&&this.tx.render()}},{key:"resize",value:function(){var e=window.innerWidth,t=window.innerHeight;this.contexts.forEach((function(i){i&&i.resize(e,t)})),this.txCanvas&&(this.txCanvas.width=e,this.txCanvas.height=t)}},{key:"keyup",value:function(e){this.contexts.forEach((function(t){t&&t.keyup(e.keyCode)}))}},{key:"keydown",value:function(e){this.contexts.forEach((function(t){t&&t.keydown(e.keyCode)}))}}])&&v(t.prototype,i),n&&v(t,n),e}()},319:function(e,t){e.exports="#define GLSLIFY 1\n#define PI 3.1415926535\nvarying vec2 vUv;\nuniform vec3 objectPosition;\nvarying vec3 vPosition;\n\nvoid main() {\n\tvUv = uv;\n\tvPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},320:function(e,t){e.exports="#define GLSLIFY 1\n#define PI 3.1415926535\n#define K 7\nuniform sampler2D color;\nuniform vec2 resolution;\nuniform int imageFormat; // 0 = hemi, 1 = cubemap\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvec2 uv_hemisphere(vec3 dir) {\n    vec2 uv;\n\tuv.x = PI + atan(dir.z, dir.x);\n\tuv.y = PI - acos( dir.y );\n\tuv /= vec2( PI*2.0, PI );\n\treturn uv;\n}\n\nvec2 uv_cube(vec3 dir) {\n    float x = dir.x;\n    float y = dir.y;\n    float z = dir.z;\n    float absX = abs(x);\n    float absY = abs(y);\n    float absZ = abs(z);\n    float isXPositive = x > 0.0 ? 1.0 : 0.0;\n    float isYPositive = y > 0.0 ? 1.0 : 0.0;\n    float isZPositive = z > 0.0 ? 1.0 : 0.0;\n    if (isXPositive > 0.5 && absX >= absY && absX >= absZ) {\n        float uc = 1.0 - 0.5f * (-z / absX + 1.0f);\n        float vc =  0.5f * (-y / absX + 1.0f);\n        float i = 1.0;\n        float j = 0.0;\n        float iu = (uc + i) / 3.0;\n        float iv = 1.0 - (vc + j) / 2.0;\n        return vec2(iu, iv);\n    }\n    if (isXPositive < 0.5 && absX >= absY && absX >= absZ) {\n        float uc = 1.0 - 0.5f * (z / absX + 1.0f);\n        float vc = 1.0 - 0.5f * (y / absX + 1.0f);\n        float i = 0.0;\n        float j = 0.0;\n        float iu = (uc + i) / 3.0;\n        float iv = 1.0 - (vc + j) / 2.0;\n        return vec2(iu, iv);\n    }\n    if (isYPositive > 0.5 && absY >= absX && absY >= absZ) {\n        float uc = 0.5f * (-x / absY + 1.0f);\n        float vc = 0.5f * (z / absY + 1.0f);\n        float i = 2.0;\n        float j = 0.0;\n        float iu = (uc + i) / 3.0;\n        float iv = 1.0 - (vc + j) / 2.0;\n        return vec2(iu, iv);\n    }\n    if (isYPositive < 0.5 && absY >= absX && absY >= absZ) {\n        float uc =  1.0 - 0.5f * (x / absY + 1.0f);\n        float vc =  1.0 - 0.5f * (z / absY + 1.0f);\n        float i = 0.0;\n        float j = 1.0;\n        float iu = (uc + i) / 3.0;\n        float iv = 1.0 - (vc + j) / 2.0;\n        return vec2(iu, iv);\n    }\n    if (isZPositive > 0.5 && absZ >= absX && absZ >= absY) {\n        float uc = 1.0 - 0.5f * (x / absZ + 1.0f);\n        float vc = 1.0 - 0.5f * (y / absZ + 1.0f);\n        float i = 1.0;\n        float j = 1.0;\n        float iu = (uc + i) / 3.0;\n        float iv = 1.0 - (vc + j) / 2.0;\n        return vec2(iu, iv);\n    }\n    if (isZPositive < 0.5 && absZ >= absX && absZ >= absY) {\n        // u (0 to 1) goes from +x to -x\n        // v (0 to 1) goes from -y to +y\n        float uc = 1.0 - 0.5f * (-x / absZ + 1.0f);\n        float vc = 1.0 - 0.5f * (y / absZ + 1.0f);\n        float i = 2.0;\n        float j = 1.0;\n        float iu = (uc + i) / 3.0;\n        float iv = 1.0 - (vc + j) / 2.0;\n        return vec2(iu, iv);\n    }\n}\n\nvoid main() {\n    if (imageFormat == 0) {\n        vec3 dir = normalize(vPosition);\n        gl_FragColor = texture2D(color, uv_hemisphere(dir));\n    } else if (imageFormat == 1) {\n        vec3 dir = normalize(vec3(vPosition.x, vPosition.y * 4.0/3.0, vPosition.z));\n        gl_FragColor = texture2D(color, uv_cube(dir));\n    } else {\n        gl_FragColor = vec4(1, 0, 0, 1);\n    }\n}"}}]);